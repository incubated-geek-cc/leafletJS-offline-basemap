<!DOCTYPE html>
<html>
  <head>
    <title>{{message}}</title>
    <link rel="icon" href="static/favicon.ico">
    <link rel="stylesheet" href="static/css/leaflet.css">
    <style>
       body {
          padding: 0;
          margin: 0;
          overflow: hidden;
          background: #ffffff;
       }

       #map {
          background: #000000;
          width: 100vw;
          height: 100vh;
       }

       #loading_gif {
           display: block;
           margin-left: auto;
           margin-right: auto;
           width: 45%;
       }
    </style>
  </head>
  <body>
    <div id="map">
       <img id="loading_gif" alt="Loading" src="static/loading.gif" />
    </div>
    <script src="static/js/leaflet.js"></script>
    <script src="static/js/sql.js"></script> 
    <script src="static/js/Leaflet.TileLayer.MBTiles.js"></script>   
    <script>
        var map = new L.Map("map", {
          minZoom: 11,
          maxZoom: 15,
          maxBoundsViscocity: 1
        });
        var basemapLayer=L.tileLayer("static/maps/toner/{z}/{x}/{y}.png", {
          minZoom: 11,
          maxZoom: 15,
          maxBoundsViscocity: 1,
          errorTileUrl: "static/error.png",
          attribution: "<span class='prefix-attribution'><em>Map tiles by <a href='http://stamen.com' target='blank'>Stamen Design</a>, under <a href='http://creativecommons.org/licenses/by/3.0' target='blank'>CC BY 3.0</a>. Data by <a href='http://openstreetmap.org' target='blank'>OpenStreetMap</a>, under <a href='http://www.openstreetmap.org/copyright' target='blank'>ODbL</a>.</span>"
        }).addTo(map);

        var xhr = new XMLHttpRequest();
        xhr.open("GET", "static/output.geojson");
        xhr.setRequestHeader("Content-Type", "application/json");
        xhr.responseType = "json";
        xhr.onload = function() {
            if (xhr.status !== 200) {
              return
            }
            var geoJSONLayer=L.geoJSON(xhr.response);
            map.fitBounds(geoJSONLayer.getBounds());
            map.setMaxBounds(geoJSONLayer.getBounds());
        };
        xhr.send();
        
        
        /*
        var basemapLayer = L.tileLayer.mbTiles("static/maps/toner.mbtiles", {
          minZoom: 11,
          maxZoom: 15,
          attribution: "<span class='prefix-attribution'><em>Map tiles by <a href='http://stamen.com' target='blank'>Stamen Design</a>, under <a href='http://creativecommons.org/licenses/by/3.0' target='blank'>CC BY 3.0</a>. Data by <a href='http://openstreetmap.org' target='blank'>OpenStreetMap</a>, under <a href='http://www.openstreetmap.org/copyright' target='blank'>ODbL</a>.</span>"
        }).addTo(map);

        basemapLayer.on("databaseloaded", function(ev) {
          console.info("MBTiles DB loaded", ev);
                   
          var popup = L.popup();
          
          function onMapClick(e) {
            popup
              .setLatLng(e.latlng)
              .setContent("You clicked the map at " + e.latlng.toString())
              .openOn(map);
          }

          map.on("click", onMapClick);
        });

        basemapLayer.on("databaseerror", function(ev) {
          console.info("MBTiles DB error", ev);
        }); 
        */
    </script>
  </body>
</html>